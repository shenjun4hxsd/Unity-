##使用传输层API

网络传输不稳定，因此需要对数据进行多次编码和校验来确保数据的有效传输。

在实现网络传输时，人们把通信问题划分成了多个小问题，然后为每个小问题设计了一个单独的协议，使得每个协议都比较简单。

国际化标准组织（ISO）和国际电报电话咨询委员会（CCITT）共同制定了开放系统互联的七层参考模型，即把网络传输划分为7个独立的层次。

ISO七层网络模型

|层级|说明|
|:--|:--|
|应用层|应用程序提供的服务|
|表示层|格式化数据，以便为应用程序提供通用接口|
|会话层|在两个节点之间建立端连接|
|传输层|面向连接或无连接的常规数据递送，TCP和UDP协议属于传输层协议|
|网络层|通过寻址来建立两个节点之间的连接，IP协议属于网络层协议|
|数据链路层|将数据分帧，添加校验机制，并处理流控制|
|物理层|原始二进制流的传输|

>其中应用层、表示层和会话层统称为应用层，没有明确的界定，一般由程序开发者实现。

>传输层、网络层、数据链路层和物理层为底层，由操作系统提供。


####应用层（应用层、表示层、会话层）

把用户的数据转化成二进制流传递给传输层。

####传输层

以TCP协议为例：

TCP提供了IP环境下的数据可靠传输，它实现了数据流传送、可靠性校验、流量控制等功能。

传输层的数据转换：数据前添加一个TCP首部。  

    TCP首部|01010110


####网络层

以IP协议为例：

IP协议用于将多个包的交换网络连接起来，它在源地址和目的地址之间传送数据包，它还提供了对数据进行重新组装的功能，以适应不同网络对包大小的不同要求。

网络层的数据转换：IP协议会给数据加上目的地地址（IP地址和端口）等信息，必要时还会拆分数据。

    IP首部|TCP首部|01010110


####数据链路层

传输中若发生差错，为了达成只将有错的有限数据进行重发，数据链路层将二进制流组合成帧，然后以帧为单位进行传送。每个帧除了要传送的数据外，还包括校验码，以使接收方能发现传输中的差错。

>比如奇偶校验码是在原信息的最后添加一位用于奇校验或偶校验的代码。如果原始信息为“10010”，因为1的个数是2，所以会在后面添加一个0，形成“100100”。如果原始信息为“11010”，因为1的个数是3，所以要在后面添加一个1，形成“110101”。对端程序只要检验最后一位，便能够初步判定数据是否正确发送，如果不正确则要求重发。可见数据链路层会拆分数据并添加一些额外数据。

    帧首部|数据  帧首部|数据  帧首部|数据




