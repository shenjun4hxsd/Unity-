##å‡½æ•°

>ä¸€ä¸ªå‡½æ•°è‹¥åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”æ­¤å‚æ•°æ˜¯ä¸€ä¸ªå­—é¢å­—ç¬¦ä¸²æˆ–tableæ„é€ å¼ï¼Œé‚£ä¹ˆåœ†æ‹¬å·ä¾¿æ˜¯å¯æœ‰å¯æ— çš„ã€‚

```lua
    -- ä¾‹å¦‚ï¼š
    
    print "Hello World"    <-->    print("Hello World")
    dofile 'a.lua'         <-->    dofile('a.lua')
    print [[a multi-line   <-->    print([[a multi-line
      message]]                      message]]
    f{x=10, y=20}          <-->    f({x=10, y=20})
    type{}                 <-->    type({})
```

&emsp;&emsp;Luaä¸ºé¢å‘å¯¹è±¡å¼çš„è°ƒç”¨ä¹Ÿæä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•---å†’å·æ“ä½œç¬¦ã€‚

```lua
    o.foo(o, x)      -- å¦ä¸€ç§å†™æ³•æ˜¯ o::foo(x)
```

&emsp;&emsp;å†’å·æ“ä½œç¬¦ä½¿è°ƒç”¨o.fooæ—¶å°†oéšå«åœ°ä½œä¸ºå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

&emsp;&emsp;ä¸€ä¸ªLuaç¨‹åºæ—¢å¯ä»¥ä½¿ç”¨ä»¥Luaç¼–å†™çš„å‡½æ•°ï¼Œåˆå¯ä»¥è°ƒç”¨ä»¥Cè¯­è¨€ç¼–å†™çš„å‡½æ•°ï¼Œè°ƒç”¨æ—¶æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚

&emsp;&emsp;è°ƒç”¨å‡½æ•°æ—¶æä¾›çš„å®å‚æ•°é‡å¯ä»¥ä¸å½¢åƒæ•°é‡ä¸åŒã€‚Luaä¼šè‡ªåŠ¨è°ƒæ•´å®å‚çš„æ•°é‡ï¼Œä»¥åŒ¹é…å‚æ•°è¡¨çš„è¦æ±‚ã€‚

```lua
    -- å‡è®¾ä¸€ä¸ªå‡½æ•°å¦‚ä¸‹ï¼š
    function f(a, b) return a or b end
    
    -- åœ¨ä»¥ä¸‹å‡ ç§è°ƒç”¨ä¸­ï¼Œå®å‚ä¸å½¢åƒçš„å¯¹åº”å…³ç³»ä¸ºï¼š
    -- è°ƒç”¨        å½¢åƒ
    f(3)          a=3, b=nil
    f(3, 4)       a=3, b=4
    f(3, 4, 5)    a=3, b=4 (5è¢«ä¸¢å¼ƒäº†) 
```

```lua
    -- é»˜è®¤å®å‚çš„åº”ç”¨
    
    function incCount(n)
        n = n or 1
        count = count + n
    end
```

####å¤šé‡è¿”å›å€¼

&emsp;&emsp;Luaå…è®¸å‡½æ•°è¿”å›å¤šä¸ªç»“æœã€‚ä¾‹å¦‚ï¼Œç”¨äºå­—ç¬¦ä¸²ä¸­å®šä½ä¸€ä¸ªæ¨¡å¼çš„å‡½æ•°string.findã€‚è¯¥å‡½æ•°è‹¥åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°äº†æŒ‡å®šçš„æ¨¡å¼ï¼Œå°†è¿”å›åŒ¹é…çš„èµ·å§‹å­—ç¬¦å’Œç»“å°¾å­—ç¬¦çš„ç´¢å¼•ã€‚

```lua
    startIndex, endIndex = string.find("hello Lua users", "Lua")
    print(startIndex, endIndex)        --> 7   9
```

&emsp;&emsp;ä»¥Luaç¼–å†™çš„å‡½æ•°åŒæ ·å¯ä»¥è¿”å›å¤šä¸ªç»“æœï¼Œåªéœ€åœ¨returnå…³é”®å­—ååˆ—å‡ºæ‰€æœ‰çš„è¿”å›å€¼å³å¯ã€‚

```lua
    -- æŸ¥æ‰¾æ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„ä½ç½®ï¼š
    
    function maximum(a)
        local index = 1         -- æœ€å¤§å€¼çš„ç´¢å¼•
        local max = a[index]    -- æœ€å¤§å€¼
        for i,val in ipairs(a) do
            if val > max then
                max = val; index = i
            end
        end
        return max, index
    end
    
    print(maximum{8, 10, 23, 12, 5})    --> 23   3
```

&emsp;&emsp;Luaä¼šè°ƒæ•´ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼æ•°é‡ä»¥é€‚åº”ä¸åŒçš„è°ƒç”¨æƒ…å†µã€‚è‹¥å°†å‡½æ•°è°ƒç”¨ä½œä¸ºä¸€æ¡å•ç‹¬è¯­å¥æ—¶ï¼ŒLuaä¼šä¸¢å¼ƒå‡½æ•°çš„æ‰€æœ‰è¿”å›å€¼ã€‚è‹¥å°†å‡½æ•°ä½œä¸ºè¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†æ¥è°ƒç”¨æ—¶ï¼ŒLuaåªä¿ç•™å‡½æ•°çš„ç¬¬ä¸€ä¸ªè¿”å›å€¼ã€‚åªæœ‰å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ˜¯ä¸€ç³»åˆ—è¡¨è¾¾å¼ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–ä»…æœ‰ä¸€ä¸ªå…ƒç´ ï¼‰æ—¶ï¼Œæ‰èƒ½è·å¾—å®ƒçš„æ‰€æœ‰è¿”å›å€¼ã€‚
&emsp;&emsp;è¿™é‡Œæ‰€è°“çš„â€œä¸€ç³»åˆ—è¡¨è¾¾å¼â€åœ¨Luaä¸­è¡¨ç°ä¸º4ç§æƒ…å†µï¼šå¤šé‡èµ‹å€¼ã€å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨ã€tableçš„æ„é€ å¼å’Œreturnè¯­å¥ã€‚

```lua
    function foo0() end                    -- æ— è¿”å›å€¼
    function foo1() return "a" end         -- è¿”å›1ä¸ªç»“æœ
    function foo2() return "a", "b" end    -- è¿”å›2ä¸ªç»“æœ
```

```lua
    x,y = foo2()                           -- x="a", y="b"
    x = foo2()                             -- x="a", "b"è¢«ä¸¢å¼ƒ
    x,y,z = 10, foo2()                     -- x=10, y="a", z="b"
    
    x,y = foo0()                           -- x=nil, y=nil
    x,y = foo1()                           -- x="a", y=nil
    x,y,z = foo2()                         -- x="a", y="b", z=nil
    
    -- å‡½æ•°è°ƒç”¨ä¸æ˜¯è¡¨è¾¾å¼æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°†åªäº§ç”Ÿä¸€ä¸ªå€¼ï¼š
    x,y = foo2(), 20                       -- x="a", y=20
    x,y = foo0(), 20, 30                   -- x=nil, y=20, 30è¢«ä¸¢å¼ƒ
    
    -- å‡½æ•°è°ƒç”¨ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„æœ€åä¸€ä¸ªï¼ˆæˆ–ä»…æœ‰çš„ï¼‰å®å‚æ—¶ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°çš„æ‰€æœ‰è¿”å›å€¼éƒ½å°†ä½œä¸ºå®å‚ä¼ å…¥ç¬¬äºŒä¸ªå‡½æ•°ã€‚å¦‚printï¼š
    
    print(foo0())            -->
    print(foo1())            --> a
    print(foo2())            --> a  b
    print(foo2(), 1)         --> a  1
    print(foo2() .. "x")     --> ax
```

&emsp;&emsp;tableæ„é€ å¼å¯ä»¥å®Œæ•´åœ°æ¥æ”¶ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„æ‰€æœ‰ç»“æœï¼š

```lua
    t = {foo0()}            -- t = {}  (ä¸€ä¸ªç©ºçš„table)
    t = {foo1()}            -- t = {"a"}
    t = {foo2()}            -- t = {"a", "b"}
```

&emsp;&emsp;ä¸è¿‡ï¼Œè¿™ç§è¡Œä¸ºåªæœ‰å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä½œä¸ºæœ€åä¸€ä¸ªå…ƒç´ æ—¶æ‰ä¼šå‘ç”Ÿï¼Œè€Œåœ¨å…¶ä»–ä½ç½®ä¸Šçš„å‡½æ•°è°ƒç”¨æ€»æ˜¯äº§ç”Ÿä¸€ä¸ªç»“æœå€¼ï¼š

```lua
    t = {foo0(), foo2(), 4}        -- t[1] = nil, t[2] = "a", t[3] = 4
```

&emsp;&emsp;æœ€åä¸€ç§æƒ…å†µæ˜¯returnè¯­å¥ï¼Œè¯¸å¦‚return f()è¿™æ ·çš„è¯­å¥å°†è¿”å›fçš„æ‰€æœ‰è¿”å›å€¼ï¼š

```lua
    function foo(i)
        if i==0 then return foo0();
        elseif i==1 then return foo1();
        elseif i==2 then return foo2()
        end
    end
    
    print(foo(1))        -- a
    print(foo(2))        -- a  b
    print(foo(0))        -- (æ— è¿”å›å€¼)
    print(foo(3))        -- (æ— è¿”å›å€¼)
```

&emsp;&emsp;ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ”¾å…¥ä¸€å¯¹åœ†æ‹¬å·ä¸­ï¼Œä»è€Œè¿«ä½¿å®ƒåªè¿”å›ä¸€ä¸ªç»“æœï¼š

```lua
    print((foo0()))      -- nil
    print((foo1()))      -- a
    print((foo2()))      -- a
```

&emsp;&emsp;è¯·æ³¨æ„returnè¯­å¥åé¢çš„å†…å®¹æ˜¯ä¸éœ€è¦åœ†æ‹¬å·çš„ã€‚ä¾‹å¦‚return (f(x))ï¼Œå°†åªè¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œæ— å…³ä¹fè¿”å›äº†å‡ ä¸ªå€¼ã€‚

&emsp;&emsp;å…³äºå¤šé‡è¿”å›å€¼è¿˜è¦ä»‹ç»ä¸€ä¸ªç‰¹æ®Šå‡½æ•° --unpackã€‚å®ƒæ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¹¶ä»ä¸‹æ ‡1å¼€å§‹è¿”å›è¯¥æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼š

```lua
    print(unpack{10, 20, 30})            --> 10  20  30
    a,b = unpack{10, 20, 30}             --> a=10, b=20, 30è¢«ä¸¢å¼ƒ
```
>Lua5.1åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œunpackä½œä¸ºå…¨å±€å‡½æ•°ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥
>```lua
    unpack(arg)
```
>è€Œ5.2ä¹‹åï¼Œunpackè¢«ç§»åˆ°äº†tableä¸‹é¢ï¼Œäºæ˜¯ç›´æ¥unpackå°±ä¼šå¯¼è‡´æŠ¥é”™ï¼Œæ–°çš„è°ƒç”¨åº”è¯¥ä¸ºï¼š
>```lua
    table.unpack(arg)
```

>åŒæ—¶ä¿®æ”¹çš„è¿˜æœ‰å¦å¤–ä¸€ä¸ªï¼šarg
ä»¥å‰ `...` å¯ä»¥åœ¨å‡½æ•°å†…ç›´æ¥ä½¿ç”¨`arg`æ¥å¤„ç†ï¼Œä½†æ˜¯5.1ä¹‹åï¼Œå°±éœ€è¦è‡ªå·±æ‰‹åŠ¨å˜æ¢æˆ`arg`äº†

>```lua
    local arg = {...}
    print(arg[1])
```

>æä¾›ä¸€ç§å…¼å®¹çš„æ–¹æ³•

>```lua
    function test(...)
        if arg ~= nil then
            arg = {...}
        end
        if unpack != nil then		-- 5.1åŠä¹‹å‰çš„ç‰ˆæœ¬
            print(unpack(arg))
        else						-- ä¹‹åçš„ç‰ˆæœ¬
            local arg = {...}
            print(table.unpack(arg))
        end
    end
```

```lua
    f = string.find
    a = {"hello", "ll"}
```

f(unpack(a))å°†è¿”å›3å’Œ4ï¼Œè¿™ä¸ç›´æ¥è°ƒç”¨string.find("hello", "ll") æ‰€è¿”å›çš„ç»“æœä¸€æ‘¸ä¸€æ ·ã€‚
è™½ç„¶è¿™ä¸ªé¢„å®šä¹‰å‡½æ•°unpackæ˜¯ç”¨Cè¯­è¨€ç›´æ¥ç¼–å†™çš„ï¼Œä½†æ˜¯ä»å¯ä»¥åœ¨Luaä¸­é€šè¿‡é€’å½’å®ç°ä¸€æ ·æ•ˆæœï¼š

```lua
    function unpack(t, i)
        i = i or 1
        if t[i] then
            return t[i], unpack(t, i+1)
        end
    end
```

&emsp;&emsp;å‡½æ•°å¯ä»¥å­˜å‚¨åˆ°å˜é‡ä¸­ï¼ˆæ— è®ºå…¨å±€å˜é‡è¿˜æ˜¯å±€éƒ¨å˜é‡ï¼‰æˆ–tableä¸­ï¼Œå¯ä»¥ä½œä¸ºå®å‚ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œè¿˜å¯ä»¥ä½œä¸ºå…¶ä»–å‡½æ•°çš„è¿”å›å€¼ã€‚

&emsp;&emsp;ä¸€ä¸ªå‡½æ•°å¯ä»¥åµŒå¥—åœ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå†…éƒ¨çš„å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°ä¸­çš„å˜é‡ã€‚

&emsp;&emsp;å‡½æ•°ä¸å…¶ä»–å€¼ä¸€æ ·éƒ½æ˜¯åŒ¿åçš„ã€‚å½“è®¨è®ºä¸€ä¸ªå‡½æ•°åæ—¶ï¼ˆä¾‹å¦‚printï¼‰ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¨è®ºä¸€ä¸ªæŒæœ‰æŸå‡½æ•°çš„å˜é‡ã€‚

####å˜é•¿å‚æ•°

Luaä¸­çš„å‡½æ•°å¯ä»¥æ¥å—ä¸åŒæ•°é‡çš„å®å‚ã€‚

```lua
    -- è¿™ä¸ªå‡½æ•°è¿”å›äº†æ‰€æœ‰å‚æ•°çš„æ€»å’Œï¼š
    
    function add( ... )
        local s = 0
        for i, v in ipairs( ... ) do  -- è¡¨è¾¾å¼{...}è¡¨ç¤ºä¸€ä¸ªç”±æ‰€æœ‰å˜é•¿å‚æ•°æ„æˆçš„æ•°ç»„ã€‚
            s = s + v
        end
        return s
    end
    
    print(add(3, 4, 10, 25, 12))        --> 54
```

å‚æ•°ä¸­çš„3ä¸ªç‚¹ï¼ˆ...ï¼‰è¡¨ç¤ºè¯¥å‡½æ•°å¯æ¥å—ä¸åŒæ•°é‡çš„å®å‚ã€‚


ğŸ”š